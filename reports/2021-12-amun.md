![Amun](/static/7ab7fcba2acd9050652b3a9bae6e1caf/4e333/amun.jpg)

Amun contest  
Findings & Analysis Report
=========================================

#### 2023-03-07

Table of contents
-----------------

*   [Overview](#overview)
    
    *   [About C4](#about-c4)
    *   [Wardens](#wardens)
*   [Summary](#summary)
*   [Scope](#scope)
*   [Severity Criteria](#severity-criteria)
*   [High Risk Findings (2)](#high-risk-findings-2)
    
    *   [\[H-01\] Unused ERC20 tokens are not refunded, and can be stolen by attacker](#h-01-unused-erc20-tokens-are-not-refunded-and-can-be-stolen-by-attacker)
    *   [\[H-02\] It might not be possible to withdraw tokens from the basket](#h-02-it-might-not-be-possible-to-withdraw-tokens-from-the-basket)
*   [Medium Risk Findings (10)](#medium-risk-findings-10)
    
    *   [\[M-01\] Function `joinTokenSingle` in `SingleTokenJoin.sol` and `SingleTokenJoinV2.sol` can be made to fail](#m-01-function-jointokensingle-in-singletokenjoinsol-and-singletokenjoinv2sol-can-be-made-to-fail)
    *   [\[M-02\] Unchecked return value from low-level call()](#m-02-unchecked-return-value-from-low-level-call)
    *   [\[M-03\] It is possible to “uninitialize” `ERC20Facet` contract](#m-03-it-is-possible-to-uninitialize-erc20facet-contract)
    *   [\[M-04\] Annualized fee APY dependence on the frequency of executing a function](#m-04-annualized-fee-apy-dependence-on-the-frequency-of-executing-a-function)
    *   [\[M-05\] `totalSupply` may exceed `LibBasketStorage.basketStorage().maxCap`](#m-05-totalsupply-may-exceed-libbasketstoragebasketstoragemaxcap)
    *   [\[M-06\] block.timestamp or deadline](#m-06-blocktimestamp-or-deadline)
    *   [\[M-07\] ERC20 return values not checked](#m-07-erc20-return-values-not-checked)
    *   [\[M-08\] SingleNativeTokenExitV2 assumes first exchange holds the outputToken](#m-08-singlenativetokenexitv2-assumes-first-exchange-holds-the-outputtoken)
    *   [\[M-09\] Failed transfer with low level call could be overlooked](#m-09-failed-transfer-with-low-level-call-could-be-overlooked)
    *   [\[M-10\] fees calculations are not accurate](#m-10-fees-calculations-are-not-accurate)
*   [Low Risk Findings (23)](#low-risk-findings-23)
*   [Non-Critical Findings (44)](#non-critical-findings-44)
*   [Gas Optimizations (50)](#gas-optimizations-50)
*   [Disclosures](#disclosures)

[](#overview)Overview
=====================

_Please note: Code4rena is an organization that puts learning at the forefront of everything we do. [Our rules and processes continue to develop over time](https://github.com/code-423n4/org/issues), and older reports may reflect previous iterations of these rules and processes. For a more current representation of Code4rena’s severity standardization rules and comprehensive judging criteria, we recommend browsing the reports from C4’s most recent contests._

[](#about-c4)About C4
---------------------

Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.

A C4 code contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.

During the code contest outlined in this document, C4 conducted an analysis of Amun smart contract system written in Solidity. The code contest took place between December 13—December 19 2021.

[](#wardens)Wardens
-------------------

30 Wardens contributed reports to the Amun contest:

1.  WatchPug ([jtp](https://github.com/jack-the-pug) and [ming](https://github.com/mingwatch))
2.  Czar102
3.  certora
4.  [csanuragjain](https://twitter.com/csanuragjain)
5.  [cmichel](https://twitter.com/cmichelio)
6.  [kenzo](https://twitter.com/KenzoAgada)
7.  robee
8.  harleythedog
9.  [JMukesh](https://twitter.com/MukeshJ_eth)
10.  [gpersoon](https://twitter.com/gpersoon)
11.  hyh
12.  [defsec](https://twitter.com/defsec_)
13.  [pauliax](https://twitter.com/SolidityDev)
14.  pedroais
15.  jayjonah8
16.  [pmerkleplant](https://twitter.com/merkleplant_eth)
17.  p4st13r4 (0xb4bb4 and [0x69e8](https://github.com/0x69e8))
18.  [gzeon](https://twitter.com/gzeon)
19.  [GiveMeTestEther](https://twitter.com/GiveMeTestEther)
20.  [Ruhum](https://twitter.com/0xruhum)
21.  Jujic
22.  [itsmeSTYJ](https://twitter.com/itsmeSTYJ)
23.  [ye0lde](https://twitter.com/_ye0lde)
24.  0x1f8b
25.  [sirhashalot](https://twitter.com/SirH4shalot)
26.  [Dravee](https://twitter.com/DylanPokun)
27.  0x0x0x
28.  saian
29.  [shenwilly](https://twitter.com/shenwilly_)
30.  hubble (ksk2345 and shri4net)

This contest was judged by [0xleastwood](https://twitter.com/liam_eastwood13).

Final report assembled by burgertime and [CloudEllie](https://twitter.com/CloudEllie1).

[](#summary)Summary
===================

The C4 analysis yielded an aggregated total of 35 unique vulnerabilities and 129 total findings. All of the issues presented here are linked back to their original finding.

Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity, 10 received a risk rating in the category of MEDIUM severity, and 23 received a risk rating in the category of LOW severity.

C4 analysis also identified 44 non-critical recommendations and 50 gas optimizations.

[](#scope)Scope
===============

The code under review can be found within the [C4 Amun contest repository](https://github.com/code-423n4/2021-12-amun), and is composed of 45 smart contracts written in the Solidity programming language and includes 585 lines of Solidity code.

[](#severity-criteria)Severity Criteria
=======================================

C4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).

Vulnerabilities are divided into three primary risk categories: high, medium, and low.

High-level considerations for vulnerabilities span the following key areas when conducting assessments:

*   Malicious Input Handling
*   Escalation of privileges
*   Arithmetic
*   Gas use

Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code423n4.com).

[](#high-risk-findings-2)High Risk Findings (2)
===============================================

[](#h-01-unused-erc20-tokens-are-not-refunded-and-can-be-stolen-by-attacker)[\[H-01\] Unused ERC20 tokens are not refunded, and can be stolen by attacker](https://github.com/code-423n4/2021-12-amun-findings/issues/201)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by WatchPug_

Under certain circumstances, e.g. `annualizedFee` being minted to `feeBeneficiary` between the time user sent the transaction and the transaction being packed into the block and causing amounts of underlying tokens for each basketToken to decrease. It’s possible or even most certainly that there will be some leftover basket underlying tokens, as `BasketFacet.sol#joinPool()` will only transfer required amounts of basket tokens from Join contracts.

However, in the current implementation, only the leftover inputToken is returned.

As a result, the leftover underlying tokens won’t be returned to the user, which constitutes users’ fund loss.

[`SingleTokenJoinV2.sol` L57-L78](https://github.com/code-423n4/2021-12-amun/blob/cf890dedf2e43ec787e8e5df65726316fda134a1/contracts/basket/contracts/singleJoinExit/SingleTokenJoinV2.sol#L57-L78)

    function joinTokenSingle(JoinTokenStructV2 calldata _joinTokenStruct)
        external
    {
        // ######## INIT TOKEN #########
        IERC20 inputToken = IERC20(_joinTokenStruct.inputToken);
    
        inputToken.safeTransferFrom(
            msg.sender,
            address(this),
            _joinTokenStruct.inputAmount
        );
    
        _joinTokenSingle(_joinTokenStruct);
    
        // ######## SEND TOKEN #########
        uint256 remainingIntermediateBalance = inputToken.balanceOf(
            address(this)
        );
        if (remainingIntermediateBalance > 0) {
            inputToken.safeTransfer(msg.sender, remainingIntermediateBalance);
        }
    }

[`BasketFacet.sol` L143-L168](https://github.com/code-423n4/2021-12-amun/blob/cf890dedf2e43ec787e8e5df65726316fda134a1/contracts/basket/contracts/facets/Basket/BasketFacet.sol#L143-L168)

    function joinPool(uint256 _amount, uint16 _referral)
        external
        override
        noReentry
    {
        require(!this.getLock(), "POOL_LOCKED");
        chargeOutstandingAnnualizedFee();
        LibBasketStorage.BasketStorage storage bs =
            LibBasketStorage.basketStorage();
        uint256 totalSupply = LibERC20Storage.erc20Storage().totalSupply;
        require(
            totalSupply.add(_amount) <= this.getCap(),
            "MAX_POOL_CAP_REACHED"
        );
    
        uint256 feeAmount = _amount.mul(bs.entryFee).div(10**18);
    
        for (uint256 i; i < bs.tokens.length; i++) {
            IERC20 token = bs.tokens[i];
            uint256 tokenAmount =
                balance(address(token)).mul(_amount.add(feeAmount)).div(
                    totalSupply
                );
            require(tokenAmount != 0, "AMOUNT_TOO_SMALL");
            token.safeTransferFrom(msg.sender, address(this), tokenAmount);
        }
        ...

Furthermore, the leftover tokens in the `SingleTokenJoinV2` contract can be stolen by calling `joinTokenSingle()` with fake `outputBasket` contract and `swap.exchange` contract.

##### [](#recommended-mitigation-steps)Recommended Mitigation Steps

Consider:

1.  Calling `IBasketFacet.calcTokensForAmount()` first and only swap for exactly the desired amounts of tokens (like `SingleTokenJoin.sol`);
2.  Or, refund leftover tokens.

**[loki-sama (Amun) acknowledged](https://github.com/code-423n4/2021-12-amun-findings/issues/201)**

[](#h-02-it-might-not-be-possible-to-withdraw-tokens-from-the-basket)[\[H-02\] It might not be possible to withdraw tokens from the basket](https://github.com/code-423n4/2021-12-amun-findings/issues/287)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by Czar102, also found by csanuragjain_

#### [](#impact)Impact

When enough basket token owners exit, it will be impossible to exit pool with the last `MIN_AMOUNT` tokens because of [this](https://github.com/code-423n4/2021-12-amun/blob/main/contracts/basket/contracts/facets/Basket/BasketFacet.sol#L228-L231) check. This will result in locking some tokens forever.

#### [](#recommended-mitigation-steps-1)Recommended Mitigation Steps

Consider resigning from this check or performing it only for the owner balance, who would need to have at least `MIN_AMOUNT` tokens.

**[loki-sama (Amun) disagreed with severity](https://github.com/code-423n4/2021-12-amun-findings/issues/287)**

**[0xleastwood (Judge) commented](https://github.com/code-423n4/2021-12-amun-findings/issues/287#issuecomment-1019032628):**

> Nice find! I think this is valid:)

[](#medium-risk-findings-10)Medium Risk Findings (10)
=====================================================

[](#m-01-function-jointokensingle-in-singletokenjoinsol-and-singletokenjoinv2sol-can-be-made-to-fail)[\[M-01\] Function `joinTokenSingle` in `SingleTokenJoin.sol` and `SingleTokenJoinV2.sol` can be made to fail](https://github.com/code-423n4/2021-12-amun-findings/issues/81)
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by pmerkleplant, also found by certora, hyh, p4st13r4, pauliax, robee, and WatchPug_

#### [](#impact-1)Impact

There’s a griefing attack vulnerability in the function `joinTokenSingle` in `SingleTokenJoin.sol` as well as `SingleTokenJoinV2.sol` which makes any user transaction fail with “FAILED_OUTPUT_AMOUNT”.

##### [](#proof-of-concept)Proof of Concept

The `JoinTokenStruct` argument for `joinTokenSingle` includes a field `outputAmount` to indicate the amount of tokens the user should receive after joining a basket (see line [135](https://github.com/code-423n4/2021-12-amun/blob/main/contracts/basket/contracts/singleJoinExit/SingleTokenJoin.sol#L135) and [130](https://github.com/code-423n4/2021-12-amun/blob/main/contracts/basket/contracts/singleJoinExit/SingleTokenJoinV2.sol#L130)).

However, this amount is compared to the contract’s balance of the token and reverts if the amount is unequal.

If an attacker sends some amount of a basket’s token to the contract, every call to this function will fail as long as the output token equals the attacker’s token send.

#### [](#recommended-mitigation-steps-2)Recommended Mitigation Steps

Refactor the `require` statement to expect at least the `outputAmount` of tokens, i.e. `require(outputAmount >= _joinTokenStruct.outputAmount)`.

**[loki-sama (Amun) confirmed](https://github.com/code-423n4/2021-12-amun-findings/issues/81)**

[](#m-02-unchecked-return-value-from-low-level-call)[\[M-02\] Unchecked return value from low-level call()](https://github.com/code-423n4/2021-12-amun-findings/issues/237)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by JMukesh, also found by certora_

#### [](#impact-2)Impact

The return value of the low-level call is not checked, so if the call fails, the Ether will be locked in the contract. If the low level is used to prevent blocking operations, consider logging failed calls.

#### [](#proof-of-concept-1)Proof of Concept

[https://github.com/code-423n4/2021-12-amun/blob/98f6e2ff91f5fcebc0489f5871183566feaec307/contracts/basket/contracts/singleJoinExit/EthSingleTokenJoinV2.sol#L26](https://github.com/code-423n4/2021-12-amun/blob/98f6e2ff91f5fcebc0489f5871183566feaec307/contracts/basket/contracts/singleJoinExit/EthSingleTokenJoinV2.sol#L26)

#### [](#recommended-mitigation-steps-3)Recommended Mitigation Steps

add condition to check return value

**[loki-sama (Amun) confirmed and disagreed with severity](https://github.com/code-423n4/2021-12-amun-findings/issues/237)**

**[0xleastwood (Judge) commented](https://github.com/code-423n4/2021-12-amun-findings/issues/237#issuecomment-1015296977):**

> Nice find! I think this could be marked as `medium` as it leaks value from the protocol but it doesn’t result in assets being lost directly. It requires `_INTERMEDIATE_TOKEN` to point to a contract which fails upon wrapping the ETH amount.

> So considering that `_INTERMEDIATE_TOKEN` must be improperly set, I will mark this as `medium`.

[](#m-03-it-is-possible-to-uninitialize-erc20facet-contract)[\[M-03\] It is possible to “uninitialize” `ERC20Facet` contract](View%20on%20GitHub)
-------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by Czar102_

#### [](#impact-3)Impact

The initialization status is defined by the [name and symbol](https://github.com/code-423n4/2021-12-amun/blob/main/contracts/basket/contracts/facets/ERC20/ERC20Facet.sol#L25-L28). It is possible it set them back to an empty string, uninitializing the contract and letting the `initialize(..)` function be called again. This way, the owner may, for example, hide minting additional tokens. Or, after accidentally setting name and symbol to empty strings, anyone can take control over the contract and mint any number of tokens.

In general, it shouldn’t be possible to initialize more than once.

#### [](#recommended-mitigation-steps-4)Recommended Mitigation Steps

Consider adding empty string checks in `setName(...)` and `setSymbol(...)` functions.

**[loki-sama (Amun) confirmed](https://github.com/code-423n4/2021-12-amun-findings/issues/276)**

[](#m-04-annualized-fee-apy-dependence-on-the-frequency-of-executing-a-function)[\[M-04\] Annualized fee APY dependence on the frequency of executing a function](https://github.com/code-423n4/2021-12-amun-findings/issues/280)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by Czar102_

#### [](#impact-4)Impact

The APY of the annualized fee is dependent on the frequency of the execution of the [`BasketFacet::chargeOutstandingAnnualizedFee()`](https://github.com/code-423n4/2021-12-amun/blob/main/contracts/basket/contracts/facets/Basket/BasketFacet.sol#L265-L279). If it is called more frequently, the compounding is more frequent and the APY is higher. For less used baskets, the APY might be lower, because the compounding will happen at lower rate.

#### [](#recommended-mitigation-steps-5)Recommended Mitigation Steps

Consider [calculating the fee](https://github.com/code-423n4/2021-12-amun/blob/main/contracts/basket/contracts/facets/Basket/BasketFacet.sol#L259-L262) as the compounding was continous or with a constant compounding period.

**[loki-sama (Amun) acknowledged](https://github.com/code-423n4/2021-12-amun-findings/issues/280)**

**[0xleastwood (Judge) commented](https://github.com/code-423n4/2021-12-amun-findings/issues/280#issuecomment-1019036751):**

> Nice find!

[](#m-05-totalsupply-may-exceed-libbasketstoragebasketstoragemaxcap)[\[M-05\] `totalSupply` may exceed `LibBasketStorage.basketStorage().maxCap`](https://github.com/code-423n4/2021-12-amun-findings/issues/283)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by Czar102, also found by gpersoon, gzeon, kenzo, and WatchPug_

#### [](#impact-5)Impact

Total supply of the token may exceed the `maxCap` introduced. This can happen when a user wants to join the pool. The [check in `BasketFacet::joinPool(...)`](https://github.com/code-423n4/2021-12-amun/blob/main/contracts/basket/contracts/facets/Basket/BasketFacet.sol#L153-L156) includes only the base amount, without fee. Thus, if fee is on and someone will want to create as many tokens as possible, the `totalSupply + _amount` will be set to `maxCap`. The call will succeed, but new tokens were also minted as the fee for `bs.feeBeneficiary` if `bs.entryFee` and `bs.entryFeeBeneficiaryShare` are nonzero. Thus, the number of tokens may exceed `maxCap`.

#### [](#recommended-mitigation-steps-6)Recommended Mitigation Steps

Consider calculating `feeAmount` and `feeBeneficiaryShare` before the `require(...)` statement and check `totalSupply.add(_amount).add(feeBanficiaryShare) <= this.getCap()`.

**[loki-sama (Amun) acknowledged](https://github.com/code-423n4/2021-12-amun-findings/issues/283)**

[](#m-06-blocktimestamp-or-deadline)[\[M-06\] block.timestamp or deadline](https://github.com/code-423n4/2021-12-amun-findings/issues/47)
-----------------------------------------------------------------------------------------------------------------------------------------

_Submitted by gpersoon, also found by kenzo and robee_

#### [](#impact-6)Impact

Some functions, like rebalance() in RebalanceManagerV3 use \_deadline as a time limit for swapExactTokensForTokens() Other functions, like \_joinTokenSingle() of SingleTokenJoinV2.sol and \_exit() of SingleNativeTokenExitV2() use block.timestamp, although a deadline field is present in the struct.

Possibly the deadline fields should have been used.

#### [](#proof-of-concept-2)Proof of Concept

[`RebalanceManagerV3.sol` L158-L203](https://github.com/code-423n4/2021-12-amun/blob/cf890dedf2e43ec787e8e5df65726316fda134a1/contracts/basket/contracts/callManagers/RebalanceManagerV3.sol#L158-L203)

    function rebalance(UnderlyingTrade[] calldata _swapsV2, uint256 _deadline)  external override onlyRebalanceManager {
    ...
            for (uint256 i; i < _swapsV2.length; i++) {
      ...
                for (uint256 j; j < trade.swaps.length; j++) {
                    ..
                    _swapUniswapV2(swap.exchange,input,0, swap.path,address(basket), _deadline );

[`RebalanceManagerV3.sol` L63-L104](https://github.com/code-423n4/2021-12-amun/blob/cf890dedf2e43ec787e8e5df65726316fda134a1/contracts/basket/contracts/callManagers/RebalanceManagerV3.sol#L63-L104)

    function _swapUniswapV2(...) {
            basket.singleCall(
                exchange,
                abi.encodeWithSelector(  IUniswapV2Router02(exchange).swapExactTokensForTokens.selector,  quantity,   minReturn,  path, recipient, deadline  ),
                0
            );

[`SingleTokenJoinV2.sol` L80-L112](https://github.com/code-423n4/2021-12-amun/blob/cf890dedf2e43ec787e8e5df65726316fda134a1/contracts/basket/contracts/singleJoinExit/SingleTokenJoinV2.sol#L80-L112)

    struct JoinTokenStructV2 {
         ...
            uint256 deadline;
         ...
        }
    function _joinTokenSingle(JoinTokenStructV2 calldata _joinTokenStruct)  internal {
         ...
               for (uint256 j; j < trade.swaps.length; j++) {
                    IPangolinRouter(swap.exchange).swapExactTokensForTokens( amountIn,  0, swap.path, address(this),  block.timestamp );
                }
            }

[`SingleNativeTokenExitV2.sol` L59-L88](https://github.com/code-423n4/2021-12-amun/blob/cf890dedf2e43ec787e8e5df65726316fda134a1/contracts/basket/contracts/singleJoinExit/SingleNativeTokenExitV2.sol#L59-L88)

     struct ExitTokenStructV2 {
            ...
            uint256 deadline;
           ...
        }
    function _exit(ExitTokenStructV2 calldata _exitTokenStruct) internal {
         ...
            for (uint256 i; i < _exitTokenStruct.trades.length; i++) {
               ...
                for (uint256 j; j < trade.swaps.length; j++) {
                    ...
                    IPangolinRouter(swap.exchange).swapExactTokensForTokens( IERC20(swap.path[0]).balanceOf(address(this)), 0, swap.path, address(this), block.timestamp );
                }
            }

#### [](#recommended-mitigation-steps-7)Recommended Mitigation Steps

Check whether the deadline fields should have been used. If so replace block.timestamp with the appropriate deadline

**[loki-sama (Amun) confirmed](https://github.com/code-423n4/2021-12-amun-findings/issues/47)**

[](#m-07-erc20-return-values-not-checked)[\[M-07\] ERC20 return values not checked](https://github.com/code-423n4/2021-12-amun-findings/issues/192)
---------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by cmichel, also found by defsec, JMukesh, p4st13r4, and WatchPug_

The `ERC20.transfer()` and `ERC20.transferFrom()` functions return a boolean value indicating success. This parameter needs to be checked for success. Some tokens do **not** revert if the transfer failed but return `false` instead.

See:

*   `SingleNativeTokenExitV2.exit`’s `outputToken.transfer(msg.sender, outputTokenBalance);`
*   `PieFactoryContract.bakePie`’s `pie.transfer(msg.sender, _initialSupply);`

#### [](#impact-7)Impact

Tokens that don’t actually perform the transfer and return `false` are still counted as a correct transfer and the tokens remain in the `SingleNativeTokenExitV2` contract and could potentially be stolen by someone else.

#### [](#recommended-mitigation-steps-8)Recommended Mitigation Steps

We recommend using [OpenZeppelin’s `SafeERC20`](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v4.1/contracts/token/ERC20/utils/SafeERC20.sol#L74) versions with the `safeTransfer` and `safeTransferFrom` functions that handle the return value check as well as non-standard-compliant tokens.

**[0xleastwood (Judge) commented](https://github.com/code-423n4/2021-12-amun-findings/issues/192#issuecomment-1019041118):**

> Nice find! I think this is valid considering the extent basket tokens are used. It is more than likely that non-standard tokens will be utilised.

[](#m-08-singlenativetokenexitv2-assumes-first-exchange-holds-the-outputtoken)[\[M-08\] SingleNativeTokenExitV2 assumes first exchange holds the outputToken](https://github.com/code-423n4/2021-12-amun-findings/issues/176)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by kenzo, also found by cmichel and hyh_

SingleNativeTokenExitV2 allows the user to exit and execute trades via multiple exchanges. When finishing the trades and sending a single output token back to the user, the contract takes that token from the last swap in the first exchange’s trades. There is nothing in the struct that signifies this will be the output token, and this also impairs the exit functionality.

#### [](#impact-8)Impact

Let’s say a basket only holds token TOKE, and user would like to exit to DAI. But there’s no exchange with good liquidity for TOKE -> DAI. So the user crafts a trade to exchange TOKE for WOKE in exchange A, and then exchange WOKE for DAI in exchange B, to finally receive back DAI. The contract will not let him do so, as the output token is taken to be the output token of the first exchange - WOKE in our example.

#### [](#proof-of-concept-3)Proof of Concept

In `exit`, the output token is taken to be the last token exchanged in the first exchange: [(Code ref)](https://github.com/code-423n4/2021-12-amun/blob/main/contracts/basket/contracts/singleJoinExit/SingleNativeTokenExitV2.sol#L92:#L96)

    address[] calldata path = _exitTokenStruct
                .trades[0]
                .swaps[_exitTokenStruct.trades[0].swaps.length - 1]
                .path;
            IERC20 outputToken = IERC20(path[path.length - 1]); //this could be not the target token

This manifests the issue I detailed above.

#### [](#recommended-mitigation-steps-9)Recommended Mitigation Steps

Have the outputToken be a parameter supplied in ExitTokenStructV2.

**[loki-sama (Amun) acknowledged](https://github.com/code-423n4/2021-12-amun-findings/issues/176)**

[](#m-09-failed-transfer-with-low-level-call-could-be-overlooked)[\[M-09\] Failed transfer with low level call could be overlooked](https://github.com/code-423n4/2021-12-amun-findings/issues/78)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by harleythedog_

#### [](#impact-9)Impact

The `CallFacet.sol` contract has the function `_call` :

    function  _call(
    	address  _target,
    	bytes  memory  _calldata,
    	uint256  _value
    ) internal {
    	require(address(this).balance >= _value, "ETH_BALANCE_TOO_LOW");
    	(bool success, ) = _target.call{value: _value}(_calldata);
    	require(success, "CALL_FAILED");
    	emit  Call(msg.sender, _target, _calldata, _value);
    }

This function is utilized in a lot of different places. According to the [Solidity docs](%5Bhttps://docs.soliditylang.org/en/develop/control-structures.html#error-handling-assert-require-revert-and-exceptions%5D(https://docs.soliditylang.org/en/develop/control-structures.html#error-handling-assert-require-revert-and-exceptions)), “The low-level functions `call`, `delegatecall` and `staticcall` return `true` as their first return value if the account called is non-existent, as part of the design of the EVM. Account existence must be checked prior to calling if needed”.

As a result, it is possible that this call will not work but `_call` will not notice anything went wrong. It could be possible that a user is interacting with an exchange or token that has been deleted, but `_call` will not notice that something has gone wrong and as a result, ether can become stuck in the contract. For this reason, it would be better to also check for the contract’s existence prior to executing `_target.call`.

For reference, see a similar high severity reported in a Uniswap audit here (report # 9): [https://github.com/Uniswap/v3-core/blob/main/audits/tob/audit.pdf](https://github.com/Uniswap/v3-core/blob/main/audits/tob/audit.pdf)

#### [](#proof-of-concept-4)Proof of Concept

See `_call` here: [`CallFacet.sol` L108](https://github.com/code-423n4/2021-12-amun/blob/98f6e2ff91f5fcebc0489f5871183566feaec307/contracts/basket/contracts/facets/Call/CallFacet.sol#L108).

#### [](#recommended-mitigation-steps-10)Recommended Mitigation Steps

To ensure tokens don’t get stuck in edge case where user is interacting with a deleted contract, make sure to check that contract actually exists before calling it.

**[loki-sama (Amun) confirmed](https://github.com/code-423n4/2021-12-amun-findings/issues/78)**

[](#m-10-fees-calculations-are-not-accurate)[\[M-10\] fees calculations are not accurate](https://github.com/code-423n4/2021-12-amun-findings/issues/73)
--------------------------------------------------------------------------------------------------------------------------------------------------------

_Submitted by certora_

after that fee is calculated, it is minted to the feeBeneficiary. simply minting the exact amount results lower fee than it should be.

#### [](#impact-10)Impact

feeBeneficiary will get less fees than it should.

#### [](#proof-of-concept-5)Proof of Concept

let’s assume that the basket assets are worth 1M dollars, and totalSupply = 1M. the result of `calcOutStandingAnnualizedFee` is 100,00 so the feeBeneficiary should get 100,00 dollars. however, when minting 100,00 the totalSupply will increase to 1,100,000 so they will own 100000/1100000 \* (1M dollars) = 90909.09 dollars instead of 100k

**[loki-sama (Amun) acknowledged](https://github.com/code-423n4/2021-12-amun-findings/issues/73#issuecomment-1004708113):**

> This is mitigated by the feeBeneficiary diluting his own shares if he gets fees on his fees.

**[0xleastwood (Judge) asked](https://github.com/code-423n4/2021-12-amun-findings/issues/73#issuecomment-1019396342):**

> I’m not exactly sure if I understand what the warden is stating here. Could you confirm @loki-sama ?

**[loki-sama (Amun) confirmed](https://github.com/code-423n4/2021-12-amun-findings/issues/73#issuecomment-1020138537):**

> Ok, I myself misunderstood. He is correct that we don’t get the full value. When we take a fee of 10% like from his example. What we do is mint 10% of the basket to ourselves. That 10% after minting is not holding 10% of the underling.

[](#low-risk-findings-23)Low Risk Findings (23)
===============================================

*   [\[L-01\] Rebalance manager can steal tokens](https://github.com/code-423n4/2021-12-amun-findings/issues/186) _Submitted by cmichel_
*   [\[L-02\] Underflow possible in rebalance() of RebalanceManagerV3](https://github.com/code-423n4/2021-12-amun-findings/issues/43) _Submitted by gpersoon, also found by certora_
*   [\[L-03\] Don’t use transfer()](https://github.com/code-423n4/2021-12-amun-findings/issues/175) _Submitted by GiveMeTestEther, also found by certora, cmichel, JMukesh, kenzo, p4st13r4, pauliax, robee, Ruhum, and WatchPug_
*   [\[L-04\] token.approve() doesn’t check return value](https://github.com/code-423n4/2021-12-amun-findings/issues/294) _Submitted by sirhashalot, also found by defsec, GiveMeTestEther, JMukesh, robee, Ruhum, and WatchPug_
*   [\[L-05\] Same facet can be added several times](https://github.com/code-423n4/2021-12-amun-findings/issues/189) _Submitted by cmichel, also found by certora_
*   [\[L-06\] Approve 0 first](https://github.com/code-423n4/2021-12-amun-findings/issues/269) _Submitted by pauliax, also found by GiveMeTestEther, itsmeSTYJ, and robee_
*   [\[L-07\] Use safe math for solidity version <8](https://github.com/code-423n4/2021-12-amun-findings/issues/28) _Submitted by robee_
*   [\[L-08\] Lost annualized fees due to early division](https://github.com/code-423n4/2021-12-amun-findings/issues/155) _Submitted by kenzo, also found by certora, cmichel, Czar102, gzeon, itsmeSTYJ, robee, and WatchPug_
*   [\[L-09\] Basket might be unusable after initialization due to \_initialSupply = 0](https://github.com/code-423n4/2021-12-amun-findings/issues/159) _Submitted by kenzo_
*   [\[L-10\] ETH that is accidentally sent to a receive() function cannot be withdrawn](https://github.com/code-423n4/2021-12-amun-findings/issues/253) _Submitted by GiveMeTestEther, also found by certora, defsec, hyh, kenzo, and pedroais_
*   [\[L-11\] Lack of access modifier in Initialize()](https://github.com/code-423n4/2021-12-amun-findings/issues/241) _Submitted by JMukesh_
*   [\[L-12\] Tokens with fee on transfer are not supported](https://github.com/code-423n4/2021-12-amun-findings/issues/220) _Submitted by WatchPug, also found by defsec, gzeon, and hyh_
*   [\[L-13\] input amount might be wrong](https://github.com/code-423n4/2021-12-amun-findings/issues/200) _Submitted by certora_
*   [\[L-14\] mint and burn of PolygonERC20Wrapper](https://github.com/code-423n4/2021-12-amun-findings/issues/275) _Submitted by pauliax, also found by certora_
*   [\[L-15\] rounding error not in favor of the system](https://github.com/code-423n4/2021-12-amun-findings/issues/293) _Submitted by certora_
*   [\[L-16\] minimum amount is too high](https://github.com/code-423n4/2021-12-amun-findings/issues/5) _Submitted by certora, also found by hyh_
*   [\[L-17\] `initialize` functions can be frontrun](https://github.com/code-423n4/2021-12-amun-findings/issues/185) _Submitted by cmichel, also found by hyh and robee_
*   [\[L-18\] Wrapped native token is assumed as the `INTERMEDIATE_TOKEN`](https://github.com/code-423n4/2021-12-amun-findings/issues/190) _Submitted by cmichel, also found by defsec and Ruhum_
*   [\[L-19\] `_joinTokenSingle` can easily fail](https://github.com/code-423n4/2021-12-amun-findings/issues/194) _Submitted by cmichel_
*   [\[L-20\] Different formulas to calculate tokenAmount](https://github.com/code-423n4/2021-12-amun-findings/issues/37) _Submitted by gpersoon_
*   [\[L-21\] addToken() require check is not consistent with others similar to it](https://github.com/code-423n4/2021-12-amun-findings/issues/2) _Submitted by jayjonah8_
*   [\[L-22\] Users can be frontrunned with higher fees](https://github.com/code-423n4/2021-12-amun-findings/issues/296) _Submitted by pedroais_
*   [\[L-23\] Incorrect comment in `LibBasketStorage.sol`](https://github.com/code-423n4/2021-12-amun-findings/issues/79) _Submitted by pmerkleplant, also found by hyh_

[](#non-critical-findings-44)Non-Critical Findings (44)
=======================================================

*   [\[N-01\] Two-step change of a critical parameter](https://github.com/code-423n4/2021-12-amun-findings/issues/10) _Submitted by certora_
*   [\[N-02\] Two-step change of a critical parameter](https://github.com/code-423n4/2021-12-amun-findings/issues/12) _Submitted by certora_
*   [\[N-03\] Owner can add more tokens than `MAX_TOKENS` in `BasketFacet`](https://github.com/code-423n4/2021-12-amun-findings/issues/278) _Submitted by Czar102_
*   [\[N-04\] Open TODOs](https://github.com/code-423n4/2021-12-amun-findings/issues/267) _Submitted by Dravee, also found by defsec, pauliax, and robee_
*   [\[N-05\] Missing zero address validation on setRebalanceManager function](https://github.com/code-423n4/2021-12-amun-findings/issues/295) _Submitted by Dravee_
*   [\[N-06\] Possible Re-entrancy](https://github.com/code-423n4/2021-12-amun-findings/issues/116) _Submitted by defsec, also found by jayjonah8_
*   [\[N-07\] Use of floating pragma](https://github.com/code-423n4/2021-12-amun-findings/issues/230) _Submitted by saian_
*   [\[N-08\] Solidity compiler versions mismatch](https://github.com/code-423n4/2021-12-amun-findings/issues/27) _Submitted by robee_
*   [\[N-09\] Two Steps Verification before Transferring Ownership](https://github.com/code-423n4/2021-12-amun-findings/issues/55) _Submitted by robee_
*   [\[N-10\] Not verified function inputs of public / external functions](https://github.com/code-423n4/2021-12-amun-findings/issues/29) _Submitted by robee_
*   [\[N-11\] Incorrect revert reason in `CallFacet::addCaller(...)`](https://github.com/code-423n4/2021-12-amun-findings/issues/273) _Submitted by Czar102_
*   [\[N-12\] No minimum fees is defined](https://github.com/code-423n4/2021-12-amun-findings/issues/243) _Submitted by JMukesh_
*   [\[N-13\] Basketfacet#calcOutStandingAnnualizedFee() uses 365 days instead of 365.25 days](https://github.com/code-423n4/2021-12-amun-findings/issues/39) _Submitted by GiveMeTestEther_
*   [\[N-14\] Due to lack of input validation , self transfer can happen](https://github.com/code-423n4/2021-12-amun-findings/issues/244) _Submitted by JMukesh_
*   [\[N-15\] \_swapsV3 after the \_swapsV2](https://github.com/code-423n4/2021-12-amun-findings/issues/291) _Submitted by pauliax_
*   [\[N-16\] `RebalanceManager.sol#setRebalanceManager()` should implement two-step transfer pattern](https://github.com/code-423n4/2021-12-amun-findings/issues/226) _Submitted by WatchPug_
*   [\[N-17\] missing zero check](https://github.com/code-423n4/2021-12-amun-findings/issues/11) _Submitted by certora_
*   [\[N-18\] pointless amountOutMin](https://github.com/code-423n4/2021-12-amun-findings/issues/167) _Submitted by certora_
*   [\[N-19\] no validation on max cap](https://github.com/code-423n4/2021-12-amun-findings/issues/74) _Submitted by certora_
*   [\[N-20\] high centralization](https://github.com/code-423n4/2021-12-amun-findings/issues/75) _Submitted by certora_
*   [\[N-21\] emit Transfer on withdraw](https://github.com/code-423n4/2021-12-amun-findings/issues/277) _Submitted by pauliax_
*   [\[N-22\] Missing checks if pairs equal tokens](https://github.com/code-423n4/2021-12-amun-findings/issues/124) _Submitted by defsec_
*   [\[N-23\] Missing validation of address argument could indefinitely lock RebalanceManager contracts](https://github.com/code-423n4/2021-12-amun-findings/issues/125) _Submitted by defsec_
*   [\[N-24\] Named return issue](https://github.com/code-423n4/2021-12-amun-findings/issues/31) _Submitted by robee_
*   [\[N-25\] wrong comment in line 228 of RebalanceManager.sol](https://github.com/code-423n4/2021-12-amun-findings/issues/50) _Submitted by robee_
*   [\[N-26\] Add zero-address check in `setRebalanceManager()`](https://github.com/code-423n4/2021-12-amun-findings/issues/91) _Submitted by shenwilly_
*   [\[N-27\] \_maxApprove user input](https://github.com/code-423n4/2021-12-amun-findings/issues/289) _Submitted by pauliax_
*   [\[N-28\] safeApprove of openZeppelin is deprecated](https://github.com/code-423n4/2021-12-amun-findings/issues/25) _Submitted by robee_
*   [\[N-29\] Lacking zero address checks](https://github.com/code-423n4/2021-12-amun-findings/issues/136) _Submitted by p4st13r4_
*   [\[N-30\] callNoValue() function does not guard against zero address](https://github.com/code-423n4/2021-12-amun-findings/issues/7) _Submitted by jayjonah8_
*   [\[N-31\] Use of floating pragmas](https://github.com/code-423n4/2021-12-amun-findings/issues/6) _Submitted by jayjonah8_
*   [\[N-32\] Setting allowance to uint256(-1) is bad practice](https://github.com/code-423n4/2021-12-amun-findings/issues/63) _Submitted by itsmeSTYJ_
*   [\[N-33\] Missing zero address check in setDefaultController](https://github.com/code-423n4/2021-12-amun-findings/issues/240) _Submitted by hubble_
*   [\[N-34\] Missing zero address check in setRebalanceManager](https://github.com/code-423n4/2021-12-amun-findings/issues/255) _Submitted by hubble_
*   [\[N-35\] In my opinion in the future, hopefully there will be improvements in ui/ux, for the features to be divided into several parts, for example home, swap, leverage and also stake/farm are separated so that it is convenient to use, and will be more detailed because of the separation. This feature is very meaningful to make it easier for users](https://github.com/code-423n4/2021-12-amun-findings/issues/90) _Submitted by 0x1f8b_
*   [\[N-36\] Division by `10 ** 18`](https://github.com/code-423n4/2021-12-amun-findings/issues/272) _Submitted by Czar102_
*   [\[N-37\] Lack of zero-address checks](https://github.com/code-423n4/2021-12-amun-findings/issues/228) _Submitted by WatchPug_
*   [\[N-38\] getTokenInPool() naming is confusing](https://github.com/code-423n4/2021-12-amun-findings/issues/3) _Submitted by jayjonah8_
*   [\[N-39\] Unnecessary struct in SingleNativeTokenExitV2](https://github.com/code-423n4/2021-12-amun-findings/issues/177) _Submitted by kenzo_
*   [\[N-40\] Typo in event name](https://github.com/code-423n4/2021-12-amun-findings/issues/137) _Submitted by p4st13r4_
*   [\[N-41\] Unlocked compiler version](https://github.com/code-423n4/2021-12-amun-findings/issues/138) _Submitted by p4st13r4_
*   [\[N-42\] Unused state variables in MintableERC20](https://github.com/code-423n4/2021-12-amun-findings/issues/139) _Submitted by p4st13r4_
*   [\[N-43\] Validate diamond implementation is not empty](https://github.com/code-423n4/2021-12-amun-findings/issues/292) _Submitted by pauliax_
*   [\[N-44\] 10\*\*18 = HUNDRED\_PERCENT](https://github.com/code-423n4/2021-12-amun-findings/issues/262) _Submitted by pauliax_

[](#gas-optimizations-50)Gas Optimizations (50)
===============================================

*   [\[G-01\] Loops can be implemented more efficiently](https://github.com/code-423n4/2021-12-amun-findings/issues/249) _Submitted by 0x0x0x, also found by defsec, Dravee, gzeon, kenzo, pmerkleplant, robee, and WatchPug_
*   [\[G-02\] ++i is more gas efficient than i++ in loops forwarding](https://github.com/code-423n4/2021-12-amun-findings/issues/108) _Submitted by defsec, also found by 0x1f8b, Jujic, robee, and WatchPug_
*   [\[G-03\] Gas saving](https://github.com/code-423n4/2021-12-amun-findings/issues/145) _Submitted by 0x1f8b_
*   [\[G-04\] Assigning local variables to unchanging storage variables](https://github.com/code-423n4/2021-12-amun-findings/issues/264) _Submitted by Czar102, also found by robee_
*   [\[G-05\] Add `contractOwner` to `canCall` in `CallFacet`](https://github.com/code-423n4/2021-12-amun-findings/issues/266) _Submitted by Czar102_
*   [\[G-06\] Use id to manage itarable addresses](https://github.com/code-423n4/2021-12-amun-findings/issues/268) _Submitted by Czar102_
*   [\[G-07\] Call function internally instead of externally](https://github.com/code-423n4/2021-12-amun-findings/issues/270) _Submitted by Czar102_
*   [\[G-08\] Redundant rewriting to memory](https://github.com/code-423n4/2021-12-amun-findings/issues/271) _Submitted by Czar102_
*   [\[G-09\] Assigning keccak operations to constant variables results in extra gas costs](https://github.com/code-423n4/2021-12-amun-findings/issues/281) _Submitted by Dravee, also found by gzeon, kenzo, and pauliax_
*   [\[G-10\] BasketFace#calcOutStandingAnnualizedFee no need for safe subtraction](https://github.com/code-423n4/2021-12-amun-findings/issues/40) _Submitted by GiveMeTestEther_
*   [\[G-11\] Upgrade pragma to at least 0.8.4](https://github.com/code-423n4/2021-12-amun-findings/issues/106) _Submitted by defsec, also found by Jujic, WatchPug, and WatchPug_
*   [\[G-12\] Gas can be saved in the `calcTokensForAmount()` loop](https://github.com/code-423n4/2021-12-amun-findings/issues/141) _Submitted by Jujic_
*   [\[G-13\] Consider making some constants as non-public to save gas](https://github.com/code-423n4/2021-12-amun-findings/issues/152) _Submitted by Jujic_
*   [\[G-14\] Only pass lockBlock as parameter instead of LibBasketStorage.basketStorage()](https://github.com/code-423n4/2021-12-amun-findings/issues/171) _Submitted by Jujic_
*   [\[G-15\] Change function visibility from public to external](https://github.com/code-423n4/2021-12-amun-findings/issues/174) _Submitted by Jujic, also found by robee_
*   [\[G-16\] Unused imports](https://github.com/code-423n4/2021-12-amun-findings/issues/13) _Submitted by robee, also found by Jujic_
*   [\[G-17\] Use `IWrappedNativeToken.deposit()` can save some gas](https://github.com/code-423n4/2021-12-amun-findings/issues/184) _Submitted by WatchPug_
*   [\[G-18\] `ReentryProtection.sol` Switching between 1, 2 instead of increasing `lockCounter` is more gas efficient](https://github.com/code-423n4/2021-12-amun-findings/issues/202) _Submitted by WatchPug_
*   [\[G-19\] `10 ** 18` can be changed to `1e18` and save some gas](https://github.com/code-423n4/2021-12-amun-findings/issues/203) _Submitted by WatchPug_
*   [\[G-20\] State variables that could be set immutable](https://github.com/code-423n4/2021-12-amun-findings/issues/18) _Submitted by robee, also found by WatchPug_
*   [\[G-21\] Avoid repeated arithmetic operations in for loop can save gas](https://github.com/code-423n4/2021-12-amun-findings/issues/205) _Submitted by WatchPug, also found by pauliax_
*   [\[G-22\] Avoid unnecessary storage read can save gas](https://github.com/code-423n4/2021-12-amun-findings/issues/207) _Submitted by WatchPug_
*   [\[G-23\] Use short circuiting can save gas](https://github.com/code-423n4/2021-12-amun-findings/issues/209) _Submitted by WatchPug_
*   [\[G-24\] Reuse operation results can save gas](https://github.com/code-423n4/2021-12-amun-findings/issues/213) _Submitted by WatchPug_
*   [\[G-25\] Remove unnecessary variables can make the code simpler and save some gas](https://github.com/code-423n4/2021-12-amun-findings/issues/214) _Submitted by WatchPug_
*   [\[G-26\] `SingleTokenJoin#joinTokenSingle()` Change `inputAmount` to `maxInputAmount` can avoid dust INTERMEDIATE\_TOKEN and save gas](https://github.com/code-423n4/2021-12-amun-findings/issues/215) _Submitted by WatchPug_
*   [\[G-27\] Avoid unnecessary external calls can save gas](https://github.com/code-423n4/2021-12-amun-findings/issues/225) _Submitted by WatchPug_
*   [\[G-28\] Internal call is more efficient than external call](https://github.com/code-423n4/2021-12-amun-findings/issues/227) _Submitted by WatchPug_
*   [\[G-29\] Gas: Intermediate min-return check in `_joinTokenSingle` is unnecessary](https://github.com/code-423n4/2021-12-amun-findings/issues/195) _Submitted by cmichel, also found by itsmeSTYJ_
*   [\[G-30\] Intermediate max-input-amount check in `_joinTokenSingle` is unnecessary](https://github.com/code-423n4/2021-12-amun-findings/issues/196) _Submitted by cmichel_
*   [\[G-31\] Gas savings](https://github.com/code-423n4/2021-12-amun-findings/issues/92) _Submitted by csanuragjain_
*   [\[G-32\] Use of \_msgSender()](https://github.com/code-423n4/2021-12-amun-findings/issues/105) _Submitted by defsec_
*   [\[G-33\] Delete - ABI Coder V2 For Gas Optimization](https://github.com/code-423n4/2021-12-amun-findings/issues/107) _Submitted by defsec_
*   [\[G-34\] Revert String Size Optimization](https://github.com/code-423n4/2021-12-amun-findings/issues/111) _Submitted by defsec, also found by robee_
*   [\[G-35\] Use a constant instead of block.timestamp for the deadline](https://github.com/code-423n4/2021-12-amun-findings/issues/117) _Submitted by defsec_
*   [\[G-36\] Less than 256 uints are not gas efficient](https://github.com/code-423n4/2021-12-amun-findings/issues/120) _Submitted by defsec_
*   [\[G-37\] uniSwapLikeRouter or swap.exchange](https://github.com/code-423n4/2021-12-amun-findings/issues/286) _Submitted by pauliax, also found by kenzo_
*   [\[G-38\] Zero transfers](https://github.com/code-423n4/2021-12-amun-findings/issues/129) _Submitted by defsec_
*   [\[G-39\] Pack structs tightly](https://github.com/code-423n4/2021-12-amun-findings/issues/260) _Submitted by pauliax_
*   [\[G-40\] uint8 index](https://github.com/code-423n4/2021-12-amun-findings/issues/21) _Submitted by robee_
*   [\[G-41\] PolygonERC20Wrapper can emit burn event instead of calling ERC20 functions](https://github.com/code-423n4/2021-12-amun-findings/issues/208) _Submitted by kenzo_
*   [\[G-42\] PolygonERC20Wrapper does not need to be ERC20](https://github.com/code-423n4/2021-12-amun-findings/issues/211) _Submitted by kenzo_
*   [\[G-43\] Locking logic in Rebalancers can be changed to avoid SSTOREs.](https://github.com/code-423n4/2021-12-amun-findings/issues/140) _Submitted by p4st13r4_
*   [\[G-44\] Not used variables](https://github.com/code-423n4/2021-12-amun-findings/issues/257) _Submitted by pauliax_
*   [\[G-45\] Subtraction in `ERC20Facet::decreaseApproval` could be “unchecked”](https://github.com/code-423n4/2021-12-amun-findings/issues/80) _Submitted by pmerkleplant_
*   [\[G-46\] Don’t initialize variables with default value](https://github.com/code-423n4/2021-12-amun-findings/issues/85) _Submitted by pmerkleplant_
*   [\[G-47\] Unnecessary array boundaries check when loading an array element twice](https://github.com/code-423n4/2021-12-amun-findings/issues/19) _Submitted by robee_
*   [\[G-48\] Removing redundant code can save gas (RebalanceManager V2 V3, BaskerFacet)](https://github.com/code-423n4/2021-12-amun-findings/issues/87) _Submitted by ye0lde_
*   [\[G-49\] Unnecessary explicit returns (BaskerFacet)](https://github.com/code-423n4/2021-12-amun-findings/issues/88) _Submitted by ye0lde_
*   [\[G-50\] BasketFacet: no need for safe subtraction](https://github.com/code-423n4/2021-12-amun-findings/issues/44) _Submitted by GiveMeTestEther_

[](#disclosures)Disclosures
===========================

C4 is an open organization governed by participants in the community.

C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.

C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.

.grvsc-container { overflow: auto; position: relative; -webkit-overflow-scrolling: touch; padding-top: 1rem; padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem)); padding-bottom: 1rem; padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem)); border-radius: 8px; border-radius: var(--grvsc-border-radius, 8px); font-feature-settings: normal; line-height: 1.4; } .grvsc-code { display: table; } .grvsc-line { display: table-row; box-sizing: border-box; width: 100%; position: relative; } .grvsc-line > \* { position: relative; } .grvsc-gutter-pad { display: table-cell; padding-left: 0.75rem; padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2); } .grvsc-gutter { display: table-cell; -webkit-user-select: none; -moz-user-select: none; user-select: none; } .grvsc-gutter::before { content: attr(data-content); } .grvsc-source { display: table-cell; padding-left: 1.5rem; padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)); padding-right: 1.5rem; padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem)); } .grvsc-source:empty::after { content: ' '; -webkit-user-select: none; -moz-user-select: none; user-select: none; } .grvsc-gutter + .grvsc-source { padding-left: 0.75rem; padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2); } /\* Line transformer styles \*/ .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before { content: ' '; position: absolute; width: 100%; } .grvsc-line-diff-add::before { background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2)); } .grvsc-line-diff-del::before { background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2)); } .grvsc-line-number { padding: 0 2px; text-align: right; opacity: 0.7; } .dark-default-dark { background-color: #1E1E1E; color: #D4D4D4; } .dark-default-dark .mtk4 { color: #569CD6; } .dark-default-dark .mtk1 { color: #D4D4D4; } .dark-default-dark .mtk11 { color: #DCDCAA; } .dark-default-dark .mtk12 { color: #9CDCFE; } .dark-default-dark .mtk3 { color: #6A9955; } .dark-default-dark .mtk15 { color: #C586C0; } .dark-default-dark .mtk7 { color: #B5CEA8; } .dark-default-dark .mtk8 { color: #CE9178; } .dark-default-dark .grvsc-line-highlighted::before { background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1)); box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5)); }